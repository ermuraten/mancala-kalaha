<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mancala (Kalaha)</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0f172a;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --accent-primary: #38bdf8;
            --accent-success: #34d399;
            --accent-danger: #f87171;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
        }

        html {
            overflow-y: scroll;
            overflow-x: hidden;
            height: 100%;
        }

        body { 
            font-family: 'Outfit', sans-serif; 
            text-align: center; 
            background: radial-gradient(circle at top left, #1e293b, var(--bg-color));
            color: var(--text-main); 
            margin: 0; 
            padding: 0;
            min-height: 100%;
            overflow-y: auto;
        }

        .main-wrapper {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px 20px 120px 20px;
            position: relative;
        }

        h1 { 
            background: linear-gradient(90deg, var(--accent-primary) 0%, #818cf8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
            font-size: 3rem;
            margin: 0 auto 5px auto;
            text-shadow: 0 4px 20px rgba(56, 189, 248, 0.3);
            width: max-content;
        }

        .controls-area {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 20px auto;
            background: var(--glass-bg);
            padding: 15px 30px;
            border-radius: 25px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: max-content;
        }
        #status { 
            font-size: 1.4em; 
            font-weight: 600; 
            margin-bottom: 30px; 
            padding: 12px 24px; 
            border-radius: 20px; 
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            display: inline-block; 
            transition: all 0.3s ease;
        }

        .board-container * {
            -webkit-touch-callout: none; /* iOS Safari */
            -webkit-user-select: none; /* Safari */
            -khtml-user-select: none; /* Konqueror HTML */
            -moz-user-select: none; /* Old versions of Firefox */
            -ms-user-select: none; /* Internet Explorer/Edge */
            user-select: none; /* Non-prefixed version, currently
                                  supported by Chrome, Edge, Opera and Firefox */
            -webkit-tap-highlight-color: transparent; /* Remove highlight on mobile */
        }
        
        .board-container {
            perspective: 1000px;
            margin: 20px auto;
        }

        .board { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(15px);
            padding: 40px; 
            border-radius: 60px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5), inset 0 0 0 1px var(--glass-border); 
            max-width: 900px; 
            position: relative; 
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            user-select: none;
            -webkit-user-select: none;
        }

        .board.flipped {
            transform: rotate(180deg);
        }

        .store { 
            width: 90px; 
            height: 240px; 
            background: rgba(15, 23, 42, 0.8);
            border-radius: 45px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            font-size: 3em; 
            font-weight: 800;
            color: var(--text-main); 
            margin: 0 30px; 
            box-shadow: inset 0 10px 20px rgba(0,0,0,0.5), 0 2px 5px rgba(255,255,255,0.05);
            border: 2px solid var(--glass-border);
            transition: all 0.3s ease; 
            position: relative;
        }

        .rows { 
            display: flex; 
            flex-direction: column; 
            gap: 30px; 
        }
        
        .row { 
            display: flex; 
            gap: 20px; 
            padding: 10px;
            border-radius: 35px;
            background: rgba(255, 255, 255, 0.02);
        }
        
        .pit { 
            width: 70px; 
            height: 70px; 
            background: rgba(15, 23, 42, 0.8);
            border-radius: 50%; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            font-size: 2em; 
            font-weight: 600;
            color: var(--text-main); 
            cursor: pointer; 
            box-shadow: inset 0 5px 15px rgba(0,0,0,0.5), 0 2px 5px rgba(255,255,255,0.05); 
            border: 2px solid var(--glass-border);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); 
            position: relative;
        }

        .pit::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 100%);
            pointer-events: none;
        }

        .pit:hover { 
            transform: scale(1.15) translateY(-5px); 
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.4);
            z-index: 10;
        }

        .flipped .pit:hover {
            transform: rotate(180deg) scale(1.15) translateY(5px);
        }

        .pit:active, .pit.selected-pit {
            transform: scale(0.95);
            background: rgba(15, 23, 42, 0.9);
            box-shadow: inset 0 10px 20px rgba(0,0,0,0.6), 0 0 15px rgba(56, 189, 248, 0.5);
            border-color: var(--accent-primary);
        }

        .pit.highlight { 
            background: #f59e0b; 
            color: #fff;
            box-shadow: 0 0 30px #f59e0b, inset 0 0 10px rgba(255,255,255,0.5); 
            transform: scale(1.2); 
            border-color: #fbbf24;
        }

        .flipped .pit.highlight {
            transform: rotate(180deg) scale(1.2);
        }

        .rules {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            padding: 30px 40px;
            border-radius: 30px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            max-width: 800px;
            margin: 40px auto 30px auto;
            text-align: left;
            line-height: 1.8;
            font-size: 1.1em;
            color: var(--text-main);
        }
        .rules h2 { 
            color: var(--text-main); 
            margin-top: 0; 
            font-size: 1.8em;
            border-bottom: 2px solid var(--glass-border);
            padding-bottom: 10px;
        }
        .rules li { 
            margin-bottom: 12px; 
            font-size: 1.1em; 
        }
        .rules b {
            color: var(--accent-primary);
        }

        /* Orientierungs-Korrektur */
        .flipped .pit, .flipped .store, .flipped .row-label {
            transform: rotate(180deg);
        }

        .row-label { 
            font-size: 1.2em; 
            font-weight: 600; 
            margin-bottom: -15px; 
            color: var(--text-muted); 
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: color 0.3s;
        }
        
        .my-side .pit { 
            border-color: var(--accent-success); 
            box-shadow: 0 0 15px rgba(52, 211, 153, 0.2), inset 0 5px 15px rgba(0,0,0,0.5); 
        }
        .my-side .pit:hover {
            background: rgba(52, 211, 153, 0.1);
            border-color: rgba(52, 211, 153, 1);
            box-shadow: 0 0 25px rgba(52, 211, 153, 0.5);
        }

        .opponent-side .pit { 
            border-color: rgba(248, 113, 113, 0.5); 
            box-shadow: 0 0 15px rgba(248, 113, 113, 0.1), inset 0 5px 15px rgba(0,0,0,0.5); 
            opacity: 0.7; 
            cursor: not-allowed; 
        }
        .opponent-side .pit:hover {
            transform: none; /* no hover effect on opponent pits */
        }
        .flipped .opponent-side .pit:hover {
            transform: rotate(180deg); /* keep it rotated */
        }
        
        .connection-status { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            color: var(--text-main); 
            padding: 10px 20px; 
            border-radius: 30px; 
            font-size: 0.9em; 
            font-weight: 600;
            z-index: 1000; 
            display: flex;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .status-dot { 
            height: 12px; 
            width: 12px; 
            background-color: var(--text-muted); 
            border-radius: 50%; 
            display: inline-block; 
            margin-right: 10px; 
            transition: all 0.3s;
        }
        .status-dot.online { 
            background-color: var(--accent-success); 
            box-shadow: 0 0 10px var(--accent-success); 
        }

        /* Hover Prediction Styles */
        .pit.hover-path {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: inset 0 0 15px rgba(255, 255, 255, 0.4);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .pit.hover-last {
            background: rgba(56, 189, 248, 0.4);
            box-shadow: 0 0 20px rgba(56, 189, 248, 0.6), inset 0 0 10px rgba(255,255,255,0.5);
            border-color: var(--accent-primary);
            transform: scale(1.1);
        }
        .flipped .pit.hover-last {
            transform: rotate(180deg) scale(1.1);
        }

        .store.hover-path {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: inset 0 0 15px rgba(255, 255, 255, 0.4);
            border-color: rgba(255, 255, 255, 0.5);
        }
        .store.hover-last {
            background: rgba(56, 189, 248, 0.4);
            box-shadow: 0 0 30px rgba(56, 189, 248, 0.6), inset 0 0 10px rgba(255,255,255,0.5);
            border-color: var(--accent-primary);
        }

        /* Kalaha specific colors */
        .store.my-kalaha {
            border-color: var(--accent-success);
            box-shadow: inset 0 10px 20px rgba(0,0,0,0.5), 0 0 20px rgba(52, 211, 153, 0.3);
            color: var(--accent-success);
        }
        .store.opponent-kalaha {
            border-color: rgba(248, 113, 113, 0.5);
            box-shadow: inset 0 10px 20px rgba(0,0,0,0.5), 0 0 15px rgba(248, 113, 113, 0.1);
            color: var(--accent-danger);
            opacity: 0.8;
        }

        .restart-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--glass-border);
            color: var(--text-main);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .restart-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        /* Game Event OSD (On-Screen Display) */
        .game-event-osd {
            position: fixed;
            bottom: 25%; /* Moved down so it doesn't block the board */
            left: 50%;
            transform: translateX(-50%) scale(0.5);
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 20px 40px;
            color: #fff;
            font-size: 2.5em;
            font-weight: 800;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            z-index: 2000;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5), inset 0 0 0 2px var(--glass-border);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .game-event-osd.show {
            opacity: 1;
            transform: translateX(-50%) scale(1);
        }
        
        .game-event-osd.extra-turn {
            color: var(--accent-success);
            text-shadow: 0 0 20px rgba(52, 211, 153, 0.5);
            border-color: rgba(52, 211, 153, 0.5);
        }

        .game-event-osd.capture {
            color: var(--accent-danger);
            text-shadow: 0 0 20px rgba(248, 113, 113, 0.5);
            border-color: rgba(248, 113, 113, 0.5);
        }

        /* Chat Styles */
        .chat-container { 
            position: fixed; 
            bottom: 40px; 
            right: 50px; 
            width: 330px; 
            background: rgba(15, 23, 42, 0.9); 
            backdrop-filter: blur(20px);
            border-radius: 20px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.4); 
            border: 1px solid var(--glass-border); 
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
            z-index: 1000; 
            transition: height 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            height: 380px; 
        }
        .chat-header { 
            background: rgba(255,255,255,0.05); 
            color: var(--text-main); 
            padding: 15px; 
            font-size: 1.1em;
            font-weight: 600; 
            cursor: pointer; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-bottom: 1px solid var(--glass-border);
        }
        .chat-header:hover {
            background: rgba(255,255,255,0.08);
        }
        .chat-messages { 
            flex-grow: 1; 
            overflow-y: auto; 
            padding: 15px; 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
            scrollbar-width: thin;
            scrollbar-color: var(--glass-border) transparent;
        }
        .chat-messages::-webkit-scrollbar { width: 6px; }
        .chat-messages::-webkit-scrollbar-thumb { background: var(--glass-border); border-radius: 10px; }

        .message { 
            padding: 8px 14px; 
            border-radius: 15px; 
            max-width: 85%; 
            word-wrap: break-word; 
            font-size: 0.95em; 
            line-height: 1.4;
            animation: fadeIn 0.3s ease;
        }
        .message.large-emoji {
            font-size: 3.5em; /* WhatsApp style big emoji */
            background: transparent !important;
            padding: 0;
            box-shadow: none !important;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message.mine { 
            align-self: flex-end; 
            background: var(--accent-primary); 
            color: #fff; 
            border-bottom-right-radius: 4px;
        }
        .message.theirs { 
            align-self: flex-start; 
            background: #334155; 
            color: var(--text-main); 
            border-bottom-left-radius: 4px;
        }
        .chat-input-area { 
            padding: 15px; 
            border-top: 1px solid var(--glass-border); 
            display: flex; 
            gap: 10px; 
            background: rgba(0,0,0,0.2); 
        }
        .emoji-btn { 
            cursor: pointer; 
            font-size: 1.4em; 
            background: none; 
            border: none; 
            padding: 5px; 
            transition: transform 0.2s; 
            color: var(--text-main);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .emoji-btn:hover { 
            transform: scale(1.1); 
            background: var(--glass-bg);
        }
        .send-btn {
            background: var(--accent-primary);
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: transform 0.2s, background 0.3s;
            box-shadow: 0 4px 10px rgba(56, 189, 248, 0.4);
        }
        .send-btn:hover {
            transform: scale(1.1);
            background: #0ea5e9;
        }
        .send-btn svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
            margin-left: -2px; /* slight visual offset for play icon */
        }
        .chat-input { 
            flex-grow: 1; 
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid var(--glass-border); 
            color: var(--text-main);
            border-radius: 20px; 
            padding: 10px 15px; 
            font-family: inherit;
            font-size: 0.95em;
            outline: none;
            transition: border-color 0.3s;
        }
        .chat-input:focus {
            border-color: var(--accent-primary);
        }
        
        #emoji-picker {
            padding: 10px; 
            background: #1e293b; 
            border-top: 1px solid var(--glass-border);
            display: none;
            flex-direction: column;
            gap: 15px;
            height: 200px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--glass-border) transparent;
        }
        #emoji-picker::-webkit-scrollbar { width: 6px; }
        #emoji-picker::-webkit-scrollbar-thumb { background: var(--glass-border); border-radius: 10px; }
        
        .emoji-category-title {
            color: var(--text-muted);
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
            text-align: left;
            padding-left: 5px;
        }
        
        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 5px;
        }

        /* --- REALISTIC MODE CSS --- */
        .theme-switch-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none; color: white; padding: 8px 16px; border-radius: 20px;
            cursor: pointer; font-weight: bold; margin-left: 10px;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4); transition: transform 0.2s;
            font-family: inherit; font-size: 1em;
        }
        .theme-switch-btn:hover { transform: scale(1.05); }

        .realistic-bg {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -2; overflow: hidden;
        }

        body.realistic-mode {
            background: transparent;
        }

        body.realistic-mode .realistic-bg {
            display: block;
        }

        .r-sky {
            position: absolute; top: 0; left: 0; width: 100%; height: 50%;
            background: linear-gradient(to bottom, #38bdf8, #bae6fd, #f0f9ff);
        }
        .r-sky::after { /* Sun */
            content: ''; position: absolute; top: 10%; right: 25%;
            width: 120px; height: 120px; background: #fef08a;
            border-radius: 50%; box-shadow: 0 0 80px #fef08a;
        }
        .r-garden {
            position: absolute; top: 50%; left: 0; width: 100%; height: 50%;
            background: linear-gradient(to bottom, #86efac, #22c55e, #16a34a);
        }
        .r-garden::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 20px;
            background: rgba(0,0,0,0.1); filter: blur(5px);
        }
        .r-floor {
            position: absolute; top: 50%; left: 0; width: 100%; height: 50%;
            background: repeating-linear-gradient(90deg, #92400e, #92400e 40px, #78350f 40px, #78350f 42px);
            transform-origin: top;
            transform: perspective(1000px) rotateX(70deg);
        }
        .r-wall { position: absolute; background: #e2e8f0; box-shadow: inset 0 0 50px rgba(0,0,0,0.1); }
        .r-wall.left { top: 0; left: 0; width: 15%; height: 100%; border-right: 15px solid #cbd5e1; }
        .r-wall.right { top: 0; right: 0; width: 15%; height: 100%; border-left: 15px solid #cbd5e1; }
        .r-wall.top { top: 0; left: 0; width: 100%; height: 10%; border-bottom: 15px solid #cbd5e1; }

        .r-curtain { position: absolute; top: 0; height: 100%; filter: drop-shadow(15px 0 20px rgba(0,0,0,0.4)); opacity: 0.9; }
        .r-curtain.c-left { left: 10%; width: 25%; }
        .r-curtain.c-right { right: 10%; width: 25%; filter: drop-shadow(-15px 0 20px rgba(0,0,0,0.4)); }

        body.realistic-mode .board-container {
            perspective: 1200px; margin-top: 60px;
        }
        body.realistic-mode .board {
            transform: rotateX(35deg) !important;
            background: linear-gradient(135deg, #b45309, #78350f);
            box-shadow: 0 80px 80px rgba(0,0,0,0.7), inset 0 0 0 5px #451a03, inset 0 0 40px #290f01;
            border-radius: 50px; transform-style: preserve-3d;
        }
        body.realistic-mode .board.flipped {
            transform: rotateX(35deg) rotateZ(180deg) !important;
        }
        body.realistic-mode .board::after {
            content: ''; position: absolute; bottom: -30px; left: 0; width: 100%; height: 100%;
            border-radius: 50px; background: #422006; transform: translateZ(-30px);
            z-index: -1; box-shadow: 0 50px 50px rgba(0,0,0,0.9);
        }

        body.realistic-mode .pit, body.realistic-mode .store {
            background: radial-gradient(circle at center, #291304 0%, #422006 80%);
            border: 2px solid #291304;
            box-shadow: inset 0 15px 25px rgba(0,0,0,0.9), inset 0 5px 5px rgba(0,0,0,0.5), 0 2px 5px rgba(255,255,255,0.1);
        }
        body.realistic-mode .row-label { text-shadow: 0 2px 5px rgba(0,0,0,0.8); color: #fff; }

        .real-stone { display: none; }
        .stone-count { display: inline; }
        .stones-container { position: absolute; inset: 0; pointer-events: none; }

        body.realistic-mode .real-stone {
            display: block; position: absolute; width: 18px; height: 14px;
            border-radius: 50% 40% 60% 40%;
            box-shadow: inset -2px -2px 5px rgba(0,0,0,0.6), inset 2px 2px 5px rgba(255,255,255,0.5), 4px 6px 8px rgba(0,0,0,0.7); z-index: 1;
        }
        body.realistic-mode .stone-count {
            position: absolute; top: -5px; right: -5px; background: rgba(0,0,0,0.8);
            color: #a7f3d0; font-size: 0.6em; padding: 2px 6px; border-radius: 12px;
            z-index: 2; font-family: monospace; border: 1px solid rgba(255,255,255,0.2);
        }

        /* --- MOBILE RESPONSIVENESS --- */
        @media (max-width: 800px) {
            body {
                padding: 10px;
                font-size: 14px;
                overflow-x: hidden;
            }
            h1 {
                font-size: 1.8em;
                margin-top: 10px;
            }
            .controls-area {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 8px;
                margin-bottom: 15px;
                width: 100%;
                max-width: 100vw;
                box-sizing: border-box;
                padding: 0 5px;
            }
            #player-name-input {
                width: 100% !important;
                max-width: 100% !important;
                margin-right: 0 !important;
                margin-bottom: 5px;
                text-align: center;
                box-sizing: border-box;
            }
            .theme-switch-btn, .restart-btn {
                margin: 0;
                padding: 8px 12px;
                font-size: 0.85em;
                flex: 1 1 auto;
                min-width: 0;
                white-space: nowrap;
            }
            .board-container {
                margin-top: 10px;
                width: 100%;
                display: flex;
                justify-content: center;
            }
            .board {
                padding: 10px 8px;
                border-radius: 25px;
                max-width: calc(100vw - 20px);
                box-sizing: border-box;
                justify-content: center;
            }
            .store {
                min-width: 38px;
                width: 38px;
                height: 130px;
                margin: 0 6px;
                font-size: 1.5em;
                border-radius: 20px;
            }
            .rows {
                gap: 8px;
                flex: 1;
                min-width: 0;
            }
            .row {
                gap: 4px;
                justify-content: center;
                padding: 5px;
            }
            .pit {
                min-width: 0;
                width: calc((100vw - 130px) / 6);
                max-width: 50px;
                height: calc((100vw - 130px) / 6);
                max-height: 50px;
                font-size: 1.1rem;
            }
            .row-label {
                font-size: 0.7em;
                margin: 3px 0;
            }
            body.realistic-mode .real-stone {
                width: 10px;
                height: 8px;
            }
            .chat-container {
                width: 100%;
                right: 0;
                bottom: 0;
                border-radius: 20px 20px 0 0;
                box-sizing: border-box;
            }
            .emoji-grid {
                grid-template-columns: repeat(5, 1fr);
                font-size: 1.5em;
            }
            .connection-status {
                position: fixed;
                top: 10px;
                right: 10px;
                padding: 6px 12px;
                font-size: 0.75em;
            }
            #status {
                font-size: 1em;
                padding: 8px 16px;
            }
            .game-event-osd {
                font-size: 1.8em;
                width: 85%;
                padding: 15px 20px;
            }
            .rules {
                margin: 20px auto;
                padding: 20px;
            }
        }
        
        @media (max-width: 500px) {
            .store {
                min-width: 32px;
                width: 32px;
                height: 110px;
                margin: 0 4px;
                font-size: 1.3em;
                border-radius: 15px;
            }
            .pit {
                width: calc((100vw - 100px) / 6);
                max-width: 42px;
                height: calc((100vw - 100px) / 6);
                max-height: 42px;
                font-size: 0.95em;
            }
            .row { gap: 3px; padding: 3px; }
            .rows { gap: 5px; }
            .board { padding: 8px 5px; border-radius: 20px; }
            body.realistic-mode .board { transform: rotateX(25deg) !important; padding: 8px 5px; }
            body.realistic-mode .board.flipped { transform: rotateX(25deg) rotateZ(180deg) !important; }
            body.realistic-mode .real-stone { width: 8px; height: 6px; }
        }

        @media (max-width: 360px) {
            .store {
                min-width: 28px;
                width: 28px;
                height: 95px;
                margin: 0 3px;
                font-size: 1.1em;
                border-radius: 12px;
            }
            .pit {
                width: calc((100vw - 85px) / 6);
                max-width: 36px;
                height: calc((100vw - 85px) / 6);
                max-height: 36px;
                font-size: 0.85em;
            }
            .board { padding: 6px 4px; }
            h1 { font-size: 1.5em; }
        }

    </style>
    <script>
        /* WebOS Magic Remote scroll polyfill */
        document.addEventListener('wheel', function(e) {
            var delta = e.deltaY || e.detail || (-e.wheelDelta);
            window.scrollBy(0, delta);
        }, { passive: true });
    </script>
</head>
<body>
    <div class="realistic-bg">
        <div class="r-sky"></div>
        <div class="r-garden"></div>
        <div class="r-floor"></div>
        <div class="r-wall left"></div>
        <div class="r-wall right"></div>
        <div class="r-wall top"></div>
        <svg class="r-curtain c-left" viewBox="0 0 100 400" preserveAspectRatio="none">
            <path d="M0,0 L100,0 C80,100 90,200 40,400 L0,400 Z" fill="rgba(255,255,255,0.8)">
                <animate attributeName="d" dur="6s" repeatCount="indefinite" values="M0,0 L100,0 C80,100 90,200 40,400 L0,400 Z; M0,0 L100,0 C60,150 100,250 50,400 L0,400 Z; M0,0 L100,0 C80,100 90,200 40,400 L0,400 Z"/>
            </path>
        </svg>
        <svg class="r-curtain c-right" viewBox="0 0 100 400" preserveAspectRatio="none">
            <path d="M100,0 L0,0 C20,100 10,200 60,400 L100,400 Z" fill="rgba(255,255,255,0.8)">
                <animate attributeName="d" dur="7s" repeatCount="indefinite" values="M100,0 L0,0 C20,100 10,200 60,400 L100,400 Z; M100,0 L0,0 C40,150 0,250 50,400 L100,400 Z; M100,0 L0,0 C20,100 10,200 60,400 L100,400 Z"/>
            </path>
        </svg>
    </div>

    <div class="main-wrapper">
    <div class="connection-status"><span class="status-dot" id="status-dot"></span><span id="connection-text">Warte auf Server...</span></div>
    <h1>Mancala (Kalaha)</h1>
    <div id="status">Warte auf Verbindung...</div>
    
    <div id="qrcode-container" style="display: none; text-align: center; background: rgba(255, 255, 255, 0.95); border-radius: 15px; padding: 20px; box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5); position: absolute; top: 35%; left: 50%; transform: translate(-50%, -50%); z-index: 1000;">
        <h3 style="color: #333; margin-top: 0; margin-bottom: 15px;">ğŸ“± Scanne mich!</h3>
        <div id="qrcode" style="display: inline-block;"></div>
    </div>

    <div id="game-event-osd" class="game-event-osd">Extrazug!</div>
    <div class="controls-area">
        <input type="text" id="player-name-input" placeholder="Dein Name..." class="chat-input" style="width: 150px; max-width: calc(100vw - 40px); display: inline-block; padding: 8px 15px; margin-right: 10px; box-sizing: border-box;" onchange="setPlayerName()">
        <button id="restart-btn" onclick="requestRestart()" class="restart-btn">ğŸ”„ Spiel neu starten</button>
        <button onclick="toggleTheme()" class="theme-switch-btn">ğŸŒ Modus: Realistisch</button>
        <button onclick="toggleSound()" id="sound-btn" class="theme-switch-btn" style="background: linear-gradient(135deg, #64748b, #475569);">ğŸ”Š Ton an</button>
    </div>

    <div class="board-container">
        <div class="board" id="game-board">
            <div class="store" id="pit-13">0</div>
            
            <div class="rows">
                <div class="row-label" id="label-top">Gegner</div>
                <div class="row" id="row-p2">
                    <div class="pit" onclick="play(12)" onmouseenter="showHover(12)" onmouseleave="clearHover()" ontouchstart="showHover(12)" ontouchend="clearHover()" id="pit-12">6</div>
                    <div class="pit" onclick="play(11)" onmouseenter="showHover(11)" onmouseleave="clearHover()" ontouchstart="showHover(11)" ontouchend="clearHover()" id="pit-11">6</div>
                    <div class="pit" onclick="play(10)" onmouseenter="showHover(10)" onmouseleave="clearHover()" ontouchstart="showHover(10)" ontouchend="clearHover()" id="pit-10">6</div>
                    <div class="pit" onclick="play(9)" onmouseenter="showHover(9)" onmouseleave="clearHover()" ontouchstart="showHover(9)" ontouchend="clearHover()" id="pit-9">6</div>
                    <div class="pit" onclick="play(8)" onmouseenter="showHover(8)" onmouseleave="clearHover()" ontouchstart="showHover(8)" ontouchend="clearHover()" id="pit-8">6</div>
                    <div class="pit" onclick="play(7)" onmouseenter="showHover(7)" onmouseleave="clearHover()" ontouchstart="showHover(7)" ontouchend="clearHover()" id="pit-7">6</div>
                </div>
                <div class="row-label" id="label-bottom">Du</div>
                <div class="row" id="row-p1">
                    <div class="pit" onclick="play(0)" onmouseenter="showHover(0)" onmouseleave="clearHover()" ontouchstart="showHover(0)" ontouchend="clearHover()" id="pit-0">6</div>
                    <div class="pit" onclick="play(1)" onmouseenter="showHover(1)" onmouseleave="clearHover()" ontouchstart="showHover(1)" ontouchend="clearHover()" id="pit-1">6</div>
                    <div class="pit" onclick="play(2)" onmouseenter="showHover(2)" onmouseleave="clearHover()" ontouchstart="showHover(2)" ontouchend="clearHover()" id="pit-2">6</div>
                    <div class="pit" onclick="play(3)" onmouseenter="showHover(3)" onmouseleave="clearHover()" ontouchstart="showHover(3)" ontouchend="clearHover()" id="pit-3">6</div>
                    <div class="pit" onclick="play(4)" onmouseenter="showHover(4)" onmouseleave="clearHover()" ontouchstart="showHover(4)" ontouchend="clearHover()" id="pit-4">6</div>
                    <div class="pit" onclick="play(5)" onmouseenter="showHover(5)" onmouseleave="clearHover()" ontouchstart="showHover(5)" ontouchend="clearHover()" id="pit-5">6</div>
                </div>
            </div>

            <div class="store" id="pit-6">0</div>
        </div>
    </div>

    <div class="rules">
        <h2>ğŸ“œ Wie man spielt (Die Regeln)</h2>
        <ul>
            <li><b>Das Ziel:</b> Sammle mehr Steine in deiner groÃŸen Sammelmulde (Kalaha) als der Gegner!</li>
            <li><b>Ziehen:</b> Klicke auf eine deiner kleinen Mulden. Die Steine werden herausgenommen und einzeln im Uhrzeigersinn in die nÃ¤chsten Mulden verteilt.</li>
            <li><b>Punkte machen:</b> Wenn du an deiner groÃŸen Sammelmulde vorbeikommst, legst du dort einen Stein ab. Die gegnerische Sammelmulde wird einfach Ã¼bersprungen!</li>
            <li><b>â­ Extrazug:</b> Landet der <i>letzte</i> Stein deines Zuges genau in deiner groÃŸen Sammelmulde? Juhu! Du darfst sofort noch einmal ziehen!</li>
            <li><b>ğŸ’¥ Fangen:</b> Landet dein letzter Stein in einer deiner eigenen Mulden, die vorher <i>leer</i> war? Und liegen in der Mulde genau gegenÃ¼ber gegnerische Steine? Dann fÃ¤ngst du diese Steine und deinen eigenen und legst sie alle in deine Sammelmulde!</li>
            <li><b>Spielende:</b> Das Spiel ist vorbei, wenn einer von euch auf seiner Seite keine Steine mehr hat. Der andere Spieler darf dann alle Steine, die noch auf seiner Seite liegen, in seine Sammelmulde legen. Wer die meisten Steine hat, gewinnt!</li>
        </ul>
    </div>

    </div><!-- /main-wrapper -->

    <!-- Chat Interface -->
    <div class="chat-container" id="chat-container">
        <div class="chat-header" onclick="toggleChat()">
            <span>ğŸ’¬ Chat</span>
            <span id="chat-toggle-icon">â–¼</span>
        </div>
        <div class="chat-messages" id="chat-messages"></div>
        <div id="emoji-picker" style="display:none;">
            <div>
                <div class="emoji-category-title">Smileys & Leute</div>
                <div class="emoji-grid">
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜€')">ğŸ˜€</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜ƒ')">ğŸ˜ƒ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜„')">ğŸ˜„</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜')">ğŸ˜</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜†')">ğŸ˜†</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜…')">ğŸ˜…</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜‚')">ğŸ˜‚</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤£')">ğŸ¤£</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜Š')">ğŸ˜Š</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜‡')">ğŸ˜‡</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜‰')">ğŸ˜‰</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜')">ğŸ˜</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥°')">ğŸ¥°</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜˜')">ğŸ˜˜</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜‹')">ğŸ˜‹</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜œ')">ğŸ˜œ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤ª')">ğŸ¤ª</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜')">ğŸ˜</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤“')">ğŸ¤“</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§')">ğŸ§</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥³')">ğŸ¥³</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜')">ğŸ˜</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜’')">ğŸ˜’</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ™„')">ğŸ™„</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜¬')">ğŸ˜¬</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜®')">ğŸ˜®</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜¯')">ğŸ˜¯</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜²')">ğŸ˜²</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜³')">ğŸ˜³</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥º')">ğŸ¥º</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜¢')">ğŸ˜¢</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜­')">ğŸ˜­</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜¤')">ğŸ˜¤</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜ ')">ğŸ˜ </span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜¡')">ğŸ˜¡</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤¬')">ğŸ¤¬</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤¯')">ğŸ¤¯</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜±')">ğŸ˜±</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥¶')">ğŸ¥¶</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥µ')">ğŸ¥µ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤”')">ğŸ¤”</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤—')">ğŸ¤—</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤«')">ğŸ¤«</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤¥')">ğŸ¤¥</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜´')">ğŸ˜´</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜ª')">ğŸ˜ª</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤¤')">ğŸ¤¤</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜·')">ğŸ˜·</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤’')">ğŸ¤’</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤•')">ğŸ¤•</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤¢')">ğŸ¤¢</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤®')">ğŸ¤®</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤§')">ğŸ¤§</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜µ')">ğŸ˜µ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤¡')">ğŸ¤¡</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜ˆ')">ğŸ˜ˆ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ’€')">ğŸ’€</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‘»')">ğŸ‘»</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‘½')">ğŸ‘½</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤–')">ğŸ¤–</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ’©')">ğŸ’©</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‘')">ğŸ‘</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‘')">ğŸ‘</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‘')">ğŸ‘</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ™Œ')">ğŸ™Œ</span>
                    <span class="emoji-btn" onclick="sendEmoji('âœŒï¸')">âœŒï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤')">ğŸ¤</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ––')">ğŸ––</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤Ÿ')">ğŸ¤Ÿ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤˜')">ğŸ¤˜</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤™')">ğŸ¤™</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ–')">ğŸ–</span>
                    <span class="emoji-btn" onclick="sendEmoji('âœ‹')">âœ‹</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‘Œ')">ğŸ‘Œ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤Œ')">ğŸ¤Œ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤')">ğŸ¤</span>
                    <span class="emoji-btn" onclick="sendEmoji('â˜ï¸')">â˜ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‘‡')">ğŸ‘‡</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‘ˆ')">ğŸ‘ˆ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‘‰')">ğŸ‘‰</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ–•')">ğŸ–•</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ’ª')">ğŸ’ª</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦¾')">ğŸ¦¾</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‘‹')">ğŸ‘‹</span>
                </div>
            </div>
            
            <div>
                <div class="emoji-category-title">Tiere & Natur</div>
                <div class="emoji-grid">
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¶')">ğŸ¶</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ±')">ğŸ±</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ­')">ğŸ­</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¹')">ğŸ¹</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ°')">ğŸ°</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦Š')">ğŸ¦Š</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ»')">ğŸ»</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¼')">ğŸ¼</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ»â€â„ï¸')">ğŸ»â€â„ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¨')">ğŸ¨</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¯')">ğŸ¯</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦')">ğŸ¦</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ®')">ğŸ®</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ·')">ğŸ·</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¸')">ğŸ¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ’')">ğŸ’</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ”')">ğŸ”</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§')">ğŸ§</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦')">ğŸ¦</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤')">ğŸ¤</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦†')">ğŸ¦†</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦…')">ğŸ¦…</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦‰')">ğŸ¦‰</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦‡')">ğŸ¦‡</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸº')">ğŸº</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ—')">ğŸ—</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ´')">ğŸ´</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦„')">ğŸ¦„</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ')">ğŸ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ›')">ğŸ›</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦‹')">ğŸ¦‹</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸŒ')">ğŸŒ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ')">ğŸ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸœ')">ğŸœ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦—')">ğŸ¦—</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ•·')">ğŸ•·</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦‚')">ğŸ¦‚</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¢')">ğŸ¢</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ')">ğŸ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦')">ğŸ¦</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦–')">ğŸ¦–</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦•')">ğŸ¦•</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ™')">ğŸ™</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦‘')">ğŸ¦‘</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦')">ğŸ¦</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦')">ğŸ¦</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦€')">ğŸ¦€</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¡')">ğŸ¡</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ ')">ğŸ </span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸŸ')">ğŸŸ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¬')">ğŸ¬</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ³')">ğŸ³</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‹')">ğŸ‹</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦ˆ')">ğŸ¦ˆ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸŠ')">ğŸŠ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ…')">ğŸ…</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ†')">ğŸ†</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦“')">ğŸ¦“</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦')">ğŸ¦</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦§')">ğŸ¦§</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦£')">ğŸ¦£</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜')">ğŸ˜</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦›')">ğŸ¦›</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦')">ğŸ¦</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸª')">ğŸª</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ«')">ğŸ«</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦’')">ğŸ¦’</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦˜')">ğŸ¦˜</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸƒ')">ğŸƒ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‚')">ğŸ‚</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ„')">ğŸ„</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ')">ğŸ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ–')">ğŸ–</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ')">ğŸ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‘')">ğŸ‘</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦™')">ğŸ¦™</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ')">ğŸ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦Œ')">ğŸ¦Œ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ•')">ğŸ•</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ©')">ğŸ©</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦®')">ğŸ¦®</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ•â€ğŸ¦º')">ğŸ•â€ğŸ¦º</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸˆ')">ğŸˆ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸˆâ€â¬›')">ğŸˆâ€â¬›</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸª¶')">ğŸª¶</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ“')">ğŸ“</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦ƒ')">ğŸ¦ƒ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦¤')">ğŸ¦¤</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦š')">ğŸ¦š</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦œ')">ğŸ¦œ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦¢')">ğŸ¦¢</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦©')">ğŸ¦©</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ•Š')">ğŸ•Š</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‡')">ğŸ‡</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦')">ğŸ¦</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦¨')">ğŸ¦¨</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦¡')">ğŸ¦¡</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦«')">ğŸ¦«</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦¦')">ğŸ¦¦</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦¥')">ğŸ¦¥</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ')">ğŸ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ€')">ğŸ€</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¿')">ğŸ¿</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦”')">ğŸ¦”</span>
                </div>
            </div>

            <div>
                <div class="emoji-category-title">Essen & Trinken</div>
                <div class="emoji-grid">
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ')">ğŸ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ')">ğŸ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ')">ğŸ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸŠ')">ğŸŠ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‹')">ğŸ‹</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸŒ')">ğŸŒ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‰')">ğŸ‰</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‡')">ğŸ‡</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ“')">ğŸ“</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ«')">ğŸ«</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸˆ')">ğŸˆ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ’')">ğŸ’</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‘')">ğŸ‘</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥­')">ğŸ¥­</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ')">ğŸ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥¥')">ğŸ¥¥</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥')">ğŸ¥</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ…')">ğŸ…</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ†')">ğŸ†</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥‘')">ğŸ¥‘</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥¦')">ğŸ¥¦</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥¬')">ğŸ¥¬</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥’')">ğŸ¥’</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸŒ¶')">ğŸŒ¶</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ«‘')">ğŸ«‘</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸŒ½')">ğŸŒ½</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥•')">ğŸ¥•</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ«’')">ğŸ«’</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§„')">ğŸ§„</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§…')">ğŸ§…</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥”')">ğŸ¥”</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ ')">ğŸ </span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥')">ğŸ¥</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥¯')">ğŸ¥¯</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ')">ğŸ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥–')">ğŸ¥–</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥¨')">ğŸ¥¨</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§€')">ğŸ§€</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥š')">ğŸ¥š</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ³')">ğŸ³</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§ˆ')">ğŸ§ˆ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥')">ğŸ¥</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§‡')">ğŸ§‡</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥“')">ğŸ¥“</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥©')">ğŸ¥©</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ—')">ğŸ—</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ–')">ğŸ–</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦´')">ğŸ¦´</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸŒ­')">ğŸŒ­</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ”')">ğŸ”</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸŸ')">ğŸŸ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ•')">ğŸ•</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ«“')">ğŸ«“</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥ª')">ğŸ¥ª</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥™')">ğŸ¥™</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§†')">ğŸ§†</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸŒ®')">ğŸŒ®</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸŒ¯')">ğŸŒ¯</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ«”')">ğŸ«”</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥—')">ğŸ¥—</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥˜')">ğŸ¥˜</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ«•')">ğŸ«•</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥«')">ğŸ¥«</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ')">ğŸ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸœ')">ğŸœ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ²')">ğŸ²</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ›')">ğŸ›</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ£')">ğŸ£</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ±')">ğŸ±</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥Ÿ')">ğŸ¥Ÿ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦ª')">ğŸ¦ª</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤')">ğŸ¤</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ™')">ğŸ™</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸš')">ğŸš</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ˜')">ğŸ˜</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥')">ğŸ¥</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥ ')">ğŸ¥ </span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥®')">ğŸ¥®</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¢')">ğŸ¢</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¡')">ğŸ¡</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§')">ğŸ§</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¨')">ğŸ¨</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¦')">ğŸ¦</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥§')">ğŸ¥§</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§')">ğŸ§</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ°')">ğŸ°</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‚')">ğŸ‚</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ®')">ğŸ®</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ­')">ğŸ­</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¬')">ğŸ¬</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ«')">ğŸ«</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¿')">ğŸ¿</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ©')">ğŸ©</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸª')">ğŸª</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸŒ°')">ğŸŒ°</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥œ')">ğŸ¥œ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¯')">ğŸ¯</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥›')">ğŸ¥›</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¼')">ğŸ¼</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ«–')">ğŸ«–</span>
                    <span class="emoji-btn" onclick="sendEmoji('â˜•ï¸')">â˜•ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸµ')">ğŸµ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§ƒ')">ğŸ§ƒ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥¤')">ğŸ¥¤</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§‹')">ğŸ§‹</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¶')">ğŸ¶</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸº')">ğŸº</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ»')">ğŸ»</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥‚')">ğŸ¥‚</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ·')">ğŸ·</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥ƒ')">ğŸ¥ƒ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¸')">ğŸ¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¹')">ğŸ¹</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§‰')">ğŸ§‰</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¾')">ğŸ¾</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§Š')">ğŸ§Š</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥„')">ğŸ¥„</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ´')">ğŸ´</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ½')">ğŸ½</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥£')">ğŸ¥£</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥¡')">ğŸ¥¡</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥¢')">ğŸ¥¢</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§‚')">ğŸ§‚</span>
                </div>
            </div>

            <div>
                 <div class="emoji-category-title">AktivitÃ¤ten</div>
                 <div class="emoji-grid">
                    <span class="emoji-btn" onclick="sendEmoji('âš½ï¸')">âš½ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ€')">ğŸ€</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸˆ')">ğŸˆ</span>
                    <span class="emoji-btn" onclick="sendEmoji('âš¾ï¸')">âš¾ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥')">ğŸ¥</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¾')">ğŸ¾</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ')">ğŸ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‰')">ğŸ‰</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥')">ğŸ¥</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ±')">ğŸ±</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸª€')">ğŸª€</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ“')">ğŸ“</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¸')">ğŸ¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ’')">ğŸ’</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‘')">ğŸ‘</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥')">ğŸ¥</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ')">ğŸ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸªƒ')">ğŸªƒ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥…')">ğŸ¥…</span>
                    <span class="emoji-btn" onclick="sendEmoji('â›³ï¸')">â›³ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸª')">ğŸª</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¹')">ğŸ¹</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ£')">ğŸ£</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤¿')">ğŸ¤¿</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥Š')">ğŸ¥Š</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥‹')">ğŸ¥‹</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ½')">ğŸ½</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ›¹')">ğŸ›¹</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ›¼')">ğŸ›¼</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ›·')">ğŸ›·</span>
                    <span class="emoji-btn" onclick="sendEmoji('â›¸')">â›¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥Œ')">ğŸ¥Œ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¿')">ğŸ¿</span>
                    <span class="emoji-btn" onclick="sendEmoji('â›·')">â›·</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‚')">ğŸ‚</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸª‚')">ğŸª‚</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‹ï¸â€â™€ï¸')">ğŸ‹ï¸â€â™€ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‹ï¸')">ğŸ‹ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‹ï¸â€â™‚ï¸')">ğŸ‹ï¸â€â™‚ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤¼â€â™€ï¸')">ğŸ¤¼â€â™€ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤¼')">ğŸ¤¼</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤¼â€â™‚ï¸')">ğŸ¤¼â€â™‚ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤¸â€â™€ï¸')">ğŸ¤¸â€â™€ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤¸')">ğŸ¤¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤¸â€â™‚ï¸')">ğŸ¤¸â€â™‚ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('â›¹ï¸â€â™€ï¸')">â›¹ï¸â€â™€ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('â›¹ï¸')">â›¹ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('â›¹ï¸â€â™‚ï¸')">â›¹ï¸â€â™‚ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤º')">ğŸ¤º</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤¾â€â™€ï¸')">ğŸ¤¾â€â™€ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤¾')">ğŸ¤¾</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤¾â€â™‚ï¸')">ğŸ¤¾â€â™‚ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸŒï¸â€â™€ï¸')">ğŸŒï¸â€â™€ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸŒï¸')">ğŸŒï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸŒï¸â€â™‚ï¸')">ğŸŒï¸â€â™‚ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‡')">ğŸ‡</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§˜â€â™€ï¸')">ğŸ§˜â€â™€ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§˜')">ğŸ§˜</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§˜â€â™‚ï¸')">ğŸ§˜â€â™‚ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ„â€â™€ï¸')">ğŸ„â€â™€ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ„')">ğŸ„</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ„â€â™‚ï¸')">ğŸ„â€â™‚ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸŠâ€â™€ï¸')">ğŸŠâ€â™€ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸŠ')">ğŸŠ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸŠâ€â™‚ï¸')">ğŸŠâ€â™‚ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤½â€â™€ï¸')">ğŸ¤½â€â™€ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤½')">ğŸ¤½</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤½â€â™‚ï¸')">ğŸ¤½â€â™‚ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸš£â€â™€ï¸')">ğŸš£â€â™€ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸš£')">ğŸš£</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸš£â€â™‚ï¸')">ğŸš£â€â™‚ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§—â€â™€ï¸')">ğŸ§—â€â™€ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§—')">ğŸ§—</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§—â€â™‚ï¸')">ğŸ§—â€â™‚ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸšµâ€â™€ï¸')">ğŸšµâ€â™€ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸšµ')">ğŸšµ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸšµâ€â™‚ï¸')">ğŸšµâ€â™‚ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸš´â€â™€ï¸')">ğŸš´â€â™€ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸš´')">ğŸš´</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸš´â€â™‚ï¸')">ğŸš´â€â™‚ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ†')">ğŸ†</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥‡')">ğŸ¥‡</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥ˆ')">ğŸ¥ˆ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥‰')">ğŸ¥‰</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ…')">ğŸ…</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ–')">ğŸ–</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸµ')">ğŸµ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ—')">ğŸ—</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ«')">ğŸ«</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸŸ')">ğŸŸ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸª')">ğŸª</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤¹â€â™€ï¸')">ğŸ¤¹â€â™€ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤¹')">ğŸ¤¹</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤¹â€â™‚ï¸')">ğŸ¤¹â€â™‚ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ­')">ğŸ­</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ©°')">ğŸ©°</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¨')">ğŸ¨</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¬')">ğŸ¬</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤')">ğŸ¤</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§')">ğŸ§</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¼')">ğŸ¼</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¹')">ğŸ¹</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¥')">ğŸ¥</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸª˜')">ğŸª˜</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ·')">ğŸ·</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸº')">ğŸº</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸª—')">ğŸª—</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¸')">ğŸ¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸª•')">ğŸª•</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ»')">ğŸ»</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ²')">ğŸ²</span>
                    <span class="emoji-btn" onclick="sendEmoji('â™Ÿ')">â™Ÿ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¯')">ğŸ¯</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ³')">ğŸ³</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ®')">ğŸ®</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ°')">ğŸ°</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§©')">ğŸ§©</span>
                 </div>
            </div>
            
            <div>
                 <div class="emoji-category-title">Symbole & Sonstiges</div>
                 <div class="emoji-grid">
                    <span class="emoji-btn" onclick="sendEmoji('â¤ï¸')">â¤ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§¡')">ğŸ§¡</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ’›')">ğŸ’›</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ’š')">ğŸ’š</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ’™')">ğŸ’™</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ’œ')">ğŸ’œ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ–¤')">ğŸ–¤</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤')">ğŸ¤</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ¤')">ğŸ¤</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ’”')">ğŸ’”</span>
                    <span class="emoji-btn" onclick="sendEmoji('â£ï¸')">â£ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ’•')">ğŸ’•</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ’')">ğŸ’</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ’“')">ğŸ’“</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ’—')">ğŸ’—</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ’–')">ğŸ’–</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ’˜')">ğŸ’˜</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ’')">ğŸ’</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ’Ÿ')">ğŸ’Ÿ</span>
                    <span class="emoji-btn" onclick="sendEmoji('â˜®ï¸')">â˜®ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('âœï¸')">âœï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('â˜ªï¸')">â˜ªï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ•‰')">ğŸ•‰</span>
                    <span class="emoji-btn" onclick="sendEmoji('â˜¸ï¸')">â˜¸ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('âœ¡ï¸')">âœ¡ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ”¯')">ğŸ”¯</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ•')">ğŸ•</span>
                    <span class="emoji-btn" onclick="sendEmoji('â˜¯ï¸')">â˜¯ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('â˜¦ï¸')">â˜¦ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ›')">ğŸ›</span>
                    <span class="emoji-btn" onclick="sendEmoji('â›')">â›</span>
                    <span class="emoji-btn" onclick="sendEmoji('â™ˆï¸')">â™ˆï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('â™‰ï¸')">â™‰ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('â™Šï¸')">â™Šï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('â™‹ï¸')">â™‹ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('â™Œï¸')">â™Œï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('â™ï¸')">â™ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('â™ï¸')">â™ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('â™ï¸')">â™ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('â™ï¸')">â™ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('â™‘ï¸')">â™‘ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('â™’ï¸')">â™’ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('â™“ï¸')">â™“ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ†”')">ğŸ†”</span>
                    <span class="emoji-btn" onclick="sendEmoji('âš›ï¸')">âš›ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸˆ³')">ğŸˆ³</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸˆ¹')">ğŸˆ¹</span>
                    <span class="emoji-btn" onclick="sendEmoji('â˜¢ï¸')">â˜¢ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('â˜£ï¸')">â˜£ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ“´')">ğŸ“´</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ“³')">ğŸ“³</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸˆ¶')">ğŸˆ¶</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸˆšï¸')">ğŸˆšï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸˆ¸')">ğŸˆ¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸˆº')">ğŸˆº</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸˆ·ï¸')">ğŸˆ·ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('âœ´ï¸')">âœ´ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ†š')">ğŸ†š</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ’®')">ğŸ’®</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ‰')">ğŸ‰</span>
                    <span class="emoji-btn" onclick="sendEmoji('ãŠ™ï¸')">ãŠ™ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ãŠ—ï¸')">ãŠ—ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸˆ´')">ğŸˆ´</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸˆµ')">ğŸˆµ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸˆ¹')">ğŸˆ¹</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸˆ²')">ğŸˆ²</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ…°ï¸')">ğŸ…°ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ…±ï¸')">ğŸ…±ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ†')">ğŸ†</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ†‘')">ğŸ†‘</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ…¾ï¸')">ğŸ…¾ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ†˜')">ğŸ†˜</span>
                    <span class="emoji-btn" onclick="sendEmoji('âŒ')">âŒ</span>
                    <span class="emoji-btn" onclick="sendEmoji('â­•ï¸')">â­•ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ›‘')">ğŸ›‘</span>
                    <span class="emoji-btn" onclick="sendEmoji('â›”ï¸')">â›”ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ“›')">ğŸ“›</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸš«')">ğŸš«</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ’¯')">ğŸ’¯</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸš·')">ğŸš·</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸš¯')">ğŸš¯</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸš³')">ğŸš³</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸš±')">ğŸš±</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ”')">ğŸ”</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ“µ')">ğŸ“µ</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸš­')">ğŸš­</span>
                    <span class="emoji-btn" onclick="sendEmoji('â—ï¸')">â—ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('â•')">â•</span>
                    <span class="emoji-btn" onclick="sendEmoji('â“')">â“</span>
                    <span class="emoji-btn" onclick="sendEmoji('â”')">â”</span>
                    <span class="emoji-btn" onclick="sendEmoji('â€¼ï¸')">â€¼ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('â‰ï¸')">â‰ï¸</span>
                    <span class="emoji-btn" onclick="sendEmoji('ğŸ§¿')">ğŸ§¿</span>
                 </div>
            </div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chat-input" class="chat-input" placeholder="Nachricht..." onkeypress="handleChatKey(event)">
            <button class="emoji-btn" title="Emojis" onclick="toggleEmojiPicker()">ğŸ˜€</button>
            <button class="send-btn" title="Senden" onclick="sendChat()">
                <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
            </button>
        </div>
    </div>

    <script src="peerjs.min.js"></script>
    <script src="qrcode.min.js"></script>
    <script src="webrtc_wrapper.js"></script>
    <script>
        // socket is globally available via webrtc_wrapper.js
        let myPlayerIndex = -1;
        let isAnimating = false;
        let currentBoard = [];
        let playerNames = ["Spieler 1", "Spieler 2"];

        let isSoundEnabled = true;

        // Web Audio API Context for stone drop sounds
        let audioCtx;
        function initAudio() {
            if (!audioCtx && isSoundEnabled) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playStoneDropSound() {
            if (!isSoundEnabled || !audioCtx) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            // Very quiet click
            osc.type = 'sine';
            osc.frequency.setValueAtTime(600 + Math.random() * 100, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.03);
            
            gainNode.gain.setValueAtTime(0.04, audioCtx.currentTime); // Very quiet
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.03);
            
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            osc.start();
            osc.stop(audioCtx.currentTime + 0.03);
        }

        function updateStatus(playerTurn, gameOver) {
            const statusDiv = document.getElementById('status');
            if (gameOver) {
                let p1Score = currentBoard[6];
                let p2Score = currentBoard[13];
                if (p1Score > p2Score) {
                    statusDiv.innerText = "ğŸ‰ " + playerNames[0] + " gewinnt! (" + p1Score + " zu " + p2Score + ")";
                } else if (p2Score > p1Score) {
                    statusDiv.innerText = "ğŸ‰ " + playerNames[1] + " gewinnt! (" + p2Score + " zu " + p1Score + ")";
                } else {
                    statusDiv.innerText = "ğŸ¤ Unentschieden!";
                }
                statusDiv.style.background = "var(--accent-primary)";
                statusDiv.style.color = "#fff";
                statusDiv.style.borderColor = "transparent";
                statusDiv.style.boxShadow = "0 0 30px rgba(56, 189, 248, 0.6)";
                return;
            }

            if (myPlayerIndex === -1) {
                statusDiv.innerText = "Zuschauermodus. " + (playerTurn === 0 ? "Spieler 1 ist dran." : "Spieler 2 ist dran.");
                statusDiv.style.background = "var(--glass-bg)";
                statusDiv.style.color = "var(--text-main)";
                statusDiv.style.borderColor = "var(--glass-border)";
                statusDiv.style.boxShadow = "none";
            } else {
                if (playerTurn === myPlayerIndex) {
                    statusDiv.innerText = "Du bist dran! WÃ¤hle eine Mulde.";
                    statusDiv.style.background = "rgba(52, 211, 153, 0.2)";
                    statusDiv.style.color = "var(--accent-success)";
                    statusDiv.style.borderColor = "var(--accent-success)";
                    statusDiv.style.boxShadow = "0 0 20px rgba(52, 211, 153, 0.3)";
                } else {
                    statusDiv.innerText = "Der Gegner Ã¼berlegt...";
                    statusDiv.style.background = "rgba(248, 113, 113, 0.1)";
                    statusDiv.style.color = "var(--accent-danger)";
                    statusDiv.style.borderColor = "rgba(248, 113, 113, 0.3)";
                    statusDiv.style.boxShadow = "none";
                }
            }
        }

        const stoneColors = ['#94a3b8', '#cbd5e1', '#64748b', '#475569', '#334155', '#f1f5f9', '#e2e8f0', '#737373'];

        function generateStonesHTML(count, isStore) {
            let html = `<span class="stone-count" ${count===0?'style="display:none;"':''}>${count}</span>`;
            html += `<div class="stones-container">`;
            for(let j=0; j<count; j++) {
                let p1 = Math.sin(j * 123 + 1) * 10000; p1 = p1 - Math.floor(p1);
                let p2 = Math.cos(j * 321 + 2) * 10000; p2 = p2 - Math.floor(p2);
                let p3 = Math.sin(j * 555 + 3) * 10000; p3 = p3 - Math.floor(p3);
                
                let color = stoneColors[Math.floor(p3 * stoneColors.length)];
                let left = 15 + p1 * 50; 
                let top = 15 + p2 * 50;  
                if(isStore) {
                    left = 20 + p1 * 60;
                    top = 10 + p2 * 70;
                }
                let rot = p1 * 360;
                
                html += `<div class="real-stone" style="left: ${left}%; top: ${top}%; transform: rotate(${rot}deg); background: ${color}"></div>`;
            }
            html += `</div>`;
            return html;
        }

        function drawBoard(boardArray) {
            for (let i = 0; i < 14; i++) {
                let el = document.getElementById(`pit-${i}`);
                if (el.dataset.count != boardArray[i]) {
                    el.dataset.count = boardArray[i];
                    let isStore = (i === 6 || i === 13);
                    el.innerHTML = generateStonesHTML(boardArray[i], isStore);
                }
            }
        }

        const sleep = ms => new Promise(r => setTimeout(r, ms));

        function showGameEvent(text, type) {
            const osd = document.getElementById('game-event-osd');
            osd.innerText = text;
            osd.className = 'game-event-osd show ' + type;
            
            setTimeout(() => {
                osd.classList.remove('show');
            }, 2000);
        }

        socket.on('init', (data) => {
            myPlayerIndex = data.playerIndex;
            if (data.playerNames) playerNames = data.playerNames;
            
            // On connect, check local storage for a saved name and send it!
            const savedName = localStorage.getItem('mancalaName');
            if (savedName) {
                document.getElementById('player-name-input').value = savedName;
                setPlayerName();
            }

            // Check local storage for sound preference
            const savedSoundPref = localStorage.getItem('mancalaSound');
            if (savedSoundPref === 'off') {
                isSoundEnabled = false;
                document.getElementById('sound-btn').innerText = 'ğŸ”‡ Ton aus';
            }
            
            updateSideVisuals();
        });

        socket.on('syncBoard', (data) => {
            currentBoard = [...data.board];
            drawBoard(currentBoard);
            updateStatus(data.currentPlayer, false);
        });

        socket.on('animateMove', async (data) => {
            isAnimating = true;
            const statusDiv = document.getElementById('status');
            statusDiv.innerText = "Steine werden verteilt... ğŸ”„";
            statusDiv.style.background = "rgba(245, 158, 11, 0.2)";
            statusDiv.style.color = "#fbbf24";
            statusDiv.style.borderColor = "#f59e0b";
            statusDiv.style.boxShadow = "0 0 20px rgba(245, 158, 11, 0.3)";

            currentBoard[data.startPit] = 0;
            drawBoard(currentBoard);
            
            for (let pit of data.path) {
                await sleep(300);
                playStoneDropSound();
                currentBoard[pit]++;
                drawBoard(currentBoard);
                
                let pitElement = document.getElementById(`pit-${pit}`);
                pitElement.classList.add('highlight');
                setTimeout(() => pitElement.classList.remove('highlight'), 250);
            }

            if (data.capture) {
                await sleep(500);
                
                // Trigger Capture Event OSD if it's our capture (or the opponent's if we are watching)
                let isMyCapture = (data.nextPlayer !== myPlayerIndex && data.nextPlayer !== -1);
                let captureText = "ğŸ’¥ Gefangen!";
                if (myPlayerIndex !== -1) {
                    captureText = isMyCapture ? "ğŸ’¥ Du hast gefangen!" : "ğŸ’¥ Gegner formatiert!";
                }
                showGameEvent(captureText, 'capture');

                statusDiv.innerText = captureText;
                statusDiv.style.background = "rgba(236, 72, 153, 0.2)";
                statusDiv.style.color = "#f472b6";
                statusDiv.style.borderColor = "#ec4899";
                statusDiv.style.boxShadow = "0 0 20px rgba(236, 72, 153, 0.4)";
                
                currentBoard[data.capture.ownPit] = 0;
                currentBoard[data.capture.fromPit] = 0;
                currentBoard = [...data.finalBoard]; 
                drawBoard(currentBoard);
                
                let kalahaElement = document.getElementById(`pit-${data.capture.toKalaha}`);
                kalahaElement.classList.add('highlight');
                setTimeout(() => kalahaElement.classList.remove('highlight'), 500);
                await sleep(1500);
            }

            currentBoard = [...data.finalBoard];
            drawBoard(currentBoard);
            
            // Trigger Extra Turn OSD
            if (data.freeTurn && !data.gameOver) {
                // If the next player is the same as the one who just moved, it's a free turn.
                // data.nextPlayer already has the correct player turn.
                let isMyTurn = (data.nextPlayer === myPlayerIndex);
                let freeTurnText = "â­ Extra-Zug!";
                if (myPlayerIndex !== -1) {
                    freeTurnText = isMyTurn ? "â­ Dein Extra-Zug!" : "â­ Gegner darf nochmal!";
                }
                showGameEvent(freeTurnText, 'extra-turn');
                await sleep(1500);
            }

            isAnimating = false;
            updateStatus(data.nextPlayer, data.gameOver);
        });

        let mobileSelectedPit = -1;
        let isTouchDevice = false;

        window.addEventListener('touchstart', function(e) {
            isTouchDevice = true;
            if (!e.target.closest('.pit')) {
                if (mobileSelectedPit !== -1) {
                    mobileSelectedPit = -1;
                    document.querySelectorAll('.pit').forEach(p => p.classList.remove('selected-pit'));
                    clearHover(true);
                }
            }
        }, { passive: true });

        function play(pitIndex) {
            initAudio(); // Initialize audio on first user interaction
            if (isAnimating) return;

            // First, if we are on mobile and tap a DIFFERENT pit, clear the selection
            if (isTouchDevice && mobileSelectedPit !== pitIndex && mobileSelectedPit !== -1) {
                document.querySelectorAll('.pit').forEach(p => p.classList.remove('selected-pit'));
                clearHover(true);
                mobileSelectedPit = -1;
            }

            if (myPlayerIndex === 0 && (pitIndex < 0 || pitIndex > 5)) return;
            if (myPlayerIndex === 1 && (pitIndex < 7 || pitIndex > 12)) return;
            if (currentBoard[pitIndex] === 0) return; // Cannot play empty pits

            // Mobile Two-Tap Logic
            if (isTouchDevice) {
                if (mobileSelectedPit !== pitIndex) {
                    mobileSelectedPit = pitIndex;
                    
                    // Highlight selected and show hover path
                    document.getElementById(`pit-${pitIndex}`).classList.add('selected-pit');
                    showHover(pitIndex, true); 
                    
                    return; // Stop here, wait for second tap to confirm
                } else {
                    mobileSelectedPit = -1; // Reset on second tap and proceed
                    document.querySelectorAll('.pit').forEach(p => p.classList.remove('selected-pit'));
                    clearHover(true);
                }
            }

            socket.emit('makeMove', pitIndex);
        }

        function requestRestart() {
            socket.emit('requestRestart');
        }

        socket.on('restartStatus', (requests) => {
            const btn = document.getElementById('restart-btn');
            if (!btn || myPlayerIndex === -1) return;
            
            let myReq = requests[myPlayerIndex];
            let oppReq = requests[1 - myPlayerIndex];

            if (myReq && !oppReq) {
                btn.innerText = "â³ Warte auf Gegner...";
                btn.style.background = "var(--accent-primary)";
            } else if (!myReq && oppReq) {
                btn.innerText = "âš ï¸ Neustart bestÃ¤tigen";
                btn.style.background = "var(--accent-danger)";
            } else {
                btn.innerText = "ğŸ”„ Spiel neu starten";
                btn.style.background = "rgba(255, 255, 255, 0.1)";
            }
        });

        function setPlayerName() {
            const name = document.getElementById('player-name-input').value.trim();
            if (name) {
                socket.emit('setName', name);
                localStorage.setItem('mancalaName', name);
            }
        }

        function showHover(pitIndex, force) {
            if (isAnimating) return;
            if (isTouchDevice && !force) return; // Ignore pure mouse events on touch devices
            
            // Only show hover for own pits
            if (myPlayerIndex === 0 && (pitIndex < 0 || pitIndex > 5)) return;
            if (myPlayerIndex === 1 && (pitIndex < 7 || pitIndex > 12)) return;
            
            let stones = currentBoard[pitIndex];
            if (stones === 0) return;

            let currentIndex = pitIndex;
            let path = [];
            
            while (stones > 0) {
                currentIndex = (currentIndex + 1) % 14;
                if ((myPlayerIndex === 0 && currentIndex === 13) || (myPlayerIndex === 1 && currentIndex === 6)) {
                    continue;
                }
                path.push(currentIndex);
                stones--;
            }

            if (path.length > 0) {
                for (let i = 0; i < path.length - 1; i++) {
                    let el = document.getElementById(`pit-${path[i]}`);
                    if (el) el.classList.add('hover-path');
                }
                let lastEl = document.getElementById(`pit-${path[path.length - 1]}`);
                if (lastEl) lastEl.classList.add('hover-last');
            }
        }

        function clearHover(force) {
            if (isTouchDevice && !force) return;

            for (let i = 0; i < 14; i++) {
                let el = document.getElementById(`pit-${i}`);
                if (el) {
                    el.classList.remove('hover-path');
                    el.classList.remove('hover-last');
                }
            }
        }

        function updateSideVisuals() {
            const board = document.getElementById('game-board');
            const p1Row = document.getElementById('row-p1');
            const p2Row = document.getElementById('row-p2');
            const labelTop = document.getElementById('label-top');
            const labelBottom = document.getElementById('label-bottom');
            const p1Kalaha = document.getElementById('pit-6');
            const p2Kalaha = document.getElementById('pit-13');

            if (!board || !p1Row || !p2Row) return;

            p1Row.classList.remove('my-side', 'opponent-side');
            p2Row.classList.remove('my-side', 'opponent-side');
            p1Kalaha.classList.remove('my-kalaha', 'opponent-kalaha');
            p2Kalaha.classList.remove('my-kalaha', 'opponent-kalaha');
            board.classList.remove('flipped');

            if (myPlayerIndex === 0) {
                p1Row.classList.add('my-side');
                p2Row.classList.add('opponent-side');
                p1Kalaha.classList.add('my-kalaha');
                p2Kalaha.classList.add('opponent-kalaha');
                labelBottom.innerText = "Deine Seite (" + playerNames[0] + ")";
                labelTop.innerText = "Gegner (" + playerNames[1] + ")";
                labelBottom.style.color = "var(--accent-success)";
                labelTop.style.color = "var(--text-muted)";
            } else if (myPlayerIndex === 1) {
                board.classList.add('flipped');
                p2Row.classList.add('my-side');
                p1Row.classList.add('opponent-side');
                p2Kalaha.classList.add('my-kalaha');
                p1Kalaha.classList.add('opponent-kalaha');
                labelBottom.innerText = "Deine Seite (" + playerNames[1] + ")";
                labelTop.innerText = "Gegner (" + playerNames[0] + ")";
                labelTop.style.color = "var(--accent-success)";
                labelBottom.style.color = "var(--text-muted)";
            } else {
                labelTop.innerText = playerNames[1];
                labelBottom.innerText = playerNames[0];
                labelTop.style.color = "var(--text-muted)";
                labelBottom.style.color = "var(--text-muted)";
            }
        }

        socket.on('playerStatus', (data) => {
            if (data.playerNames) playerNames = data.playerNames;
            updateSideVisuals();
            
            const dot = document.getElementById('status-dot');
            const text = document.getElementById('connection-text');
            
            if (data.playerCount >= 2) {
                dot.classList.add('online');
                text.innerText = "Mitspieler: " + playerNames[0] + " & " + playerNames[1];
            } else {
                dot.classList.remove('online');
                text.innerText = "Warte auf Mitspieler... (" + data.playerCount + "/2)";
            }
        });

        // WhatsApp Style Emoji Checker
        function isOnlyEmojis(str) {
            // Check if string is not empty and consists solely of Emoji characters and spaces
            const emojiRegex = /^[\p{Emoji}\s]+$/u;
            // Also need to exclude basic numbers/letters that might be caught by broad emoji regex
            const hasText = /[a-zA-Z0-9\.,!\?]/;
            return emojiRegex.test(str) && !hasText.test(str);
        }

        socket.on('chatMessage', (data) => {
            const chatBox = document.getElementById('chat-messages');
            const msgDiv = document.createElement('div');
            msgDiv.classList.add('message');
            
            let isLargeEmoji = isOnlyEmojis(data.text);

            if (data.id === socket.id) {
                msgDiv.classList.add('mine');
                if (isLargeEmoji) {
                    msgDiv.classList.add('large-emoji');
                    msgDiv.innerText = data.text;
                } else {
                    msgDiv.innerText = data.text;
                }
            } else if (data.id === 'server') {
                msgDiv.style.background = "var(--glass-bg)";
                msgDiv.style.color = "var(--text-muted)";
                msgDiv.style.maxWidth = "100%";
                msgDiv.style.textAlign = "center";
                msgDiv.innerText = data.text;
            } else {
                msgDiv.classList.add('theirs');
                const name = data.senderName || (data.playerIndex >= 0 ? "Sp. " + (data.playerIndex + 1) : "Zuschauer");
                if (isLargeEmoji) {
                    msgDiv.classList.add('large-emoji');
                    msgDiv.innerHTML = `<div style="font-size: 0.35em; color: var(--text-muted); margin-bottom: 5px; text-shadow: none; font-family: sans-serif;"><strong>${name}:</strong></div>${data.text}`;
                } else {
                    msgDiv.innerHTML = `<strong>${name}:</strong> ${data.text}`;
                }
            }
            
            chatBox.appendChild(msgDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        });

        function handleChatKey(e) {
            if (e.key === 'Enter') sendChat();
        }

        function sendChat() {
            const input = document.getElementById('chat-input');
            const msg = input.value.trim();
            if (msg) {
                socket.emit('chatMessage', msg);
                input.value = '';
                document.getElementById('emoji-picker').style.display = 'none';
            }
        }

        function toggleEmojiPicker() {
            const picker = document.getElementById('emoji-picker');
            const chatContainer = document.getElementById('chat-container');
            const chatMessages = document.getElementById('chat-messages');

            if (picker.style.display === 'none') {
                picker.style.display = 'flex';
                let newHeight = chatMessages.scrollHeight > 200 ? '550px' : '450px';
                chatContainer.style.height = newHeight;
                setTimeout(() => picker.scrollTop = 0, 10);
            } else {
                picker.style.display = 'none';
                chatContainer.style.height = '380px';
            }
        }

        function sendEmoji(emoji) {
            const input = document.getElementById('chat-input');
            input.value += emoji;
            input.focus();
        }

        function toggleChat() {
            const chatContainer = document.getElementById('chat-container');
            const icon = document.getElementById('chat-toggle-icon');
            if (chatContainer.style.height === '55px') {
                chatContainer.style.height = '380px';
                icon.innerText = 'â–¼';
            } else {
                chatContainer.style.height = '55px';
                icon.innerText = 'â–²';
                document.getElementById('emoji-picker').style.display = 'none';
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('realistic-mode');
            const btn = document.querySelector('.theme-switch-btn');
            if (document.body.classList.contains('realistic-mode')) {
                btn.innerText = 'ğŸ§ª Modus: Standard';
            } else {
                btn.innerText = 'ğŸŒ Modus: Realistisch';
            }
        }

        function toggleSound() {
            isSoundEnabled = !isSoundEnabled;
            const btn = document.getElementById('sound-btn');
            if (isSoundEnabled) {
                btn.innerText = 'ğŸ”Š Ton an';
                localStorage.setItem('mancalaSound', 'on');
                initAudio();
            } else {
                btn.innerText = 'ğŸ”‡ Ton aus';
                localStorage.setItem('mancalaSound', 'off');
            }
        }

    </script>
</body>
</html>
